<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="plumber">
<title>Tips &amp; Tricks • plumber</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tips &amp; Tricks">
<meta property="og:description" content="plumber">
<meta property="og:image" content="https://www.rplumber.io/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">plumber</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/quickstart.html">Quickstart</a>
    <a class="dropdown-item" href="../articles/routing-and-input.html">Routing &amp; Input</a>
    <a class="dropdown-item" href="../articles/rendering-output.html">Rendering Output</a>
    <a class="dropdown-item" href="../articles/execution-model.html">Runtime</a>
    <a class="dropdown-item" href="../articles/security.html">Security</a>
    <a class="dropdown-item" href="../articles/hosting.html">Hosting</a>
    <a class="dropdown-item" href="../articles/programmatic-usage.html">Programmatic Usage</a>
    <a class="dropdown-item" href="../articles/annotations.html">Annotations reference</a>
    <a class="dropdown-item" href="../articles/tips-and-tricks.html">Tips &amp; Tricks</a>
    <a class="dropdown-item" href="../articles/migration.html">Migration Guide</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://blog.rstudio.com/2021/03/29/plumber-v1-1-0/">Version 1.1.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rstudio/plumber/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Tips &amp; Tricks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/plumber/blob/HEAD/vignettes/tips-and-tricks.Rmd" class="external-link"><code>vignettes/tips-and-tricks.Rmd</code></a></small>
      <div class="d-none name"><code>tips-and-tricks.Rmd</code></div>
    </div>

    
    
<p><img src="files/images/plumber_broken.png" width="45%" style="float:right;"></p>
<div class="section level2">
<h2 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h2>
<p>If you’ve historically used R interactively, you may find it
difficult to define functions that get executed at once without your
input as Plumber requires. There are a couple of debugging techniques to
be aware of when working on your Plumber APIs; these techniques are
equally transferable to debugging your R scripts, packages, or
reports.</p>
<div class="section level3">
<h3 id="print-debugging">Print Debugging<a class="anchor" aria-label="anchor" href="#print-debugging"></a>
</h3>
<p>Most programmers first approach debugging by adding print statements
to their code in order to inspect the state at some point. In R,
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> or <code><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat()</a></code> can be used to print out some
state. For instance, <code>cat("i is currently: ", i)</code> could be
inserted in your code to help you ensure that the variable
<code>i</code> is what it should be at that point in your code.</p>
<p>This approach is equally viable with Plumber. When developing your
Plumber API in an interactive environment, this debugging output will be
logged to the same terminal where you called <code>run()</code> on your
API. In a non-interactive production environment, these messages will be
included in the API server logs for later inspection.</p>
</div>
<div class="section level3">
<h3 id="router-stage-debugging">Router Stage Debugging<a class="anchor" aria-label="anchor" href="#router-stage-debugging"></a>
</h3>
<p>Similar to print debugging, we can output what plumber knows at each
stage of the processing pipeline. You can do this by adding <a href="./programmatic-usage.html#router-hooks">hooks</a> to two key
stages: <code>"postroute"</code> and <code>"postserialize"</code>.</p>
<p>For example, we can add these lines to our <code>plumber.R</code>
file:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @plumber</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">pr</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pr</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/pr_hook.html">pr_hook</a></span><span class="op">(</span><span class="st">"postroute"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Print stage information</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        stage <span class="op">=</span> <span class="st">"postroute"</span>,</span>
<span>        type <span class="op">=</span> <span class="va">req</span><span class="op">$</span><span class="va">REQUEST_METHOD</span>,</span>
<span>        path <span class="op">=</span> <span class="va">req</span><span class="op">$</span><span class="va">PATH_INFO</span>,</span>
<span>        value <span class="op">=</span> <span class="va">value</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>      <span class="co"># Must return the `value` since we took one in</span></span>
<span>      <span class="va">value</span></span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/pr_hook.html">pr_hook</a></span><span class="op">(</span><span class="st">"postserialize"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Print stage information</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        stage <span class="op">=</span> <span class="st">"postserialize"</span>,</span>
<span>        type <span class="op">=</span> <span class="va">req</span><span class="op">$</span><span class="va">REQUEST_METHOD</span>,</span>
<span>        path <span class="op">=</span> <span class="va">req</span><span class="op">$</span><span class="va">PATH_INFO</span>,</span>
<span>        value <span class="op">=</span> <span class="va">value</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>      <span class="co"># Must return the `value` since we took one in</span></span>
<span>      <span class="va">value</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If we were to execute a <code>GET</code> request on
<code>/stage_debug</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /stage_debug</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>, we would expect to see output like:</p>
<pre><code>List of 4
 $ stage: chr "postroute"
 $ type : chr "GET"
 $ path : chr "/stage_debug"
 $ value: num 42
List of 4
 $ stage: chr "postserialize"
 $ type : chr "GET"
 $ path : chr "/stage_debug"
 $ value:List of 3
  ..$ status : int 200
  ..$ headers:List of 1
  .. ..$ Content-Type: chr "application/json"
  ..$ body   : 'json' chr "[42]"</code></pre>
<p>This output shows that the route <code>/stage_debug</code> calculated
the value <code>42</code> and that the value was serialized using json.
We should expect to see that the received response has a status of
<code>200</code> and the body containing JSON matching
<code>[42]</code>.</p>
</div>
<div class="section level3">
<h3 id="interactive-debugging">Interactive Debugging<a class="anchor" aria-label="anchor" href="#interactive-debugging"></a>
</h3>
<p>Print debugging is an obvious starting point, but most developers
eventually wish for something more powerful. In R, this capacity is
built in to the <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> function. If you’re unfamiliar,
<code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> pauses the execution of some function and gives
you an interactive session in which you can inspect the current value of
internal variables or even proceed through your function one statement
at a time.</p>
<p>You can leverage <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> when developing your APIs
locally by adding a <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> call in one of your filters
or endpoints and then visiting your API in a client. This offers a
powerful technique to use when you want to inspect multiple different
variables or interact with the current state of things inside of your
function. This is also a good way to get your hands dirty with Plumber
and get better acquainted with how things behave at a low level.
Consider the following API endpoint:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If you run this API locally and then visit the API in a web browser,
you’ll see your R session switch into debug mode when the request
arrives, allowing you to look at the objects contained inside your
<code>req</code> and <code>res</code> objects.</p>
</div>
</div>
<div class="section level2">
<h2 id="port-range">Port Range<a class="anchor" aria-label="anchor" href="#port-range"></a>
</h2>
<p>You can use [httpuv::randomPort()] to define a range of port for
Plumber to pick from when running an API.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plumber.R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"plumber.port"</span> <span class="op">=</span> <span class="fu">httpuv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/httpuv/man/randomPort.html" class="external-link">randomPort</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">4000</span>, max <span class="op">=</span> <span class="fl">7000</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### define the rest of your plumber router...</span></span></code></pre></div>
<p>or more programmatically</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pr.html">pr</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pr_run.html">pr_run</a></span><span class="op">(</span>port <span class="op">=</span> <span class="fu">httpuv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/httpuv/man/randomPort.html" class="external-link">randomPort</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">4000</span>, max <span class="op">=</span> <span class="fl">7000</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="http://schloerke.com" class="external-link">Barret Schloerke</a>, <a href="https://trestletech.com/" class="external-link">Jeff Allen</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer>
</body>
</html>
